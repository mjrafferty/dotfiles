#! /bin/bash

SRC=$1
DES=$2
if [ "x${1}" == "x" ] || [ "x${2}" == "x" ]; then
	printf "\e[1;31m --Please specify a valid source and destination DB!-- \e[0m\n"
else
	CRE=$(iworx -s --add-both ${DES})
	CHK=$(printf "${CRE}" | grep -v "DB Name" | grep -v "DB User" | grep -v "DB Pass")
	NAM=$(printf "${CRE}" | grep "DB Name" | awk '{print $4}')
	UZR=$(printf "${CRE}" | grep "DB User" | awk '{print $4}')
	PSS=$(printf "${CRE}" | grep "DB Pass" | awk '{print $4}')
	CUZ=$(pwd -P | awk -F "/" '{print $4}')
	if [ "x${CHK}" == "x" ]; then
		mysqldump --opt --skip-lock-tables --routines --max_allowed_packet=2G -u"$(grep ^rootdsn= /usr/local/interworx/iworx.ini | cut -d/ -f3 | cut -d: -f1)" -p"$(grep ^rootdsn= /usr/local/interworx/iworx.ini | cut -d: -f3 | cut -d\@ -f1)" "${CUZ}_${SRC}" | mysql -u ${UZR} -p${PSS} ${NAM}
		printf "${CRE}\n"
	else
		printf "shit\n"
	fi
fi
