#! /bin/bash

## Generate or update .htpasswd file to add username

# Display usage info
if [[ "$1" == "-h" || "$1" == "--help" ]]; then
  echo -e "\n Usage: htpasswdauth [-u|--user username] [-p|--pass password] [-l length]\n    Ex: htpasswdauth -u username -p passwod\n    Ex: htpasswdauth -u username -l 5\n    Ex: htpasswdauth -u username\n";
  exit 0;
fi

# Get username
if [[ -z $1 ]]; then
  echo;
  read -rp "Username: " U;
elif [[ $1 == '-u' || $1 == '--user' ]]; then
  U="$2";
fi;

# Set password
if [[ -z $3 ]]; then
  P=$(xkcd);
elif [[ $3 == '-p' || $3 == '--pass' ]]; then
  P="$4";
elif [[ $3 == '-l' ]]; then
  P=$(xkcd -l "$4");
fi

# Write information to file
if [[ -f .htpasswd ]]; then
  sudo -u "$(getusr)" htpasswd -mb .htpasswd "$U" "$P";
else
  sudo -u "$(getusr)" htpasswd -cmb .htpasswd "$U" "$P";
fi;

# Display configured username and password
echo -e "\nUsername: $U\nPassword: $P\n";
