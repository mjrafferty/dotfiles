#! /bin/bash

query=$1;

domains=$(grep -H "Server.* $query" /etc/httpd/conf.d/vhost_* | sed -r 's/.*vhost_(.*).conf.* ('"$query"'[^ ]*).*/\1\t\2/' | sort -u);

domain=($(echo "$domains" | cut -f1));

alias=($(echo "$domains" | cut -f2));

for (( i=1; i<=${domain[@]}; i++ )); do
	docroot[$i]=$(sed -nr 's/.*DocumentRoot (.*)/\1/p' /etc/httpd/conf.d/vhost_"$domain[$i]".conf | head -n1);
done;

for (( i=1; i<=${domain[@]}; i++ )); do
	echo "$alias[$i]\t$domain[$i]\t$docroot[$i]";
done;

if [ -z "${alias[0]}" ]; then
	echo "Domain not found";
	return;
elif [ "${alias[1]}" ]; then
	echo "Domain ambiguous";
	return;
fi;


cd "$docroot" || echo "Could not locate docroot";
