#! /bin/bash

## Set default permissions for files and directories
if [[ $1 == '-h' || $1 == '--help' ]]; then 
	echo -e "\n Usage: fixperms [path]\n    Set file permissions to 644 and folder permissions to 2755\n"; 
	return 0; 
fi
if [[ -n $1 ]]; then 
	SITEPATH="$1"; 
else 
	SITEPATH="."; 
fi

if [[ $(grep -i ^loadmodule.*php[0-9]_module /etc/httpd/conf.d/php.conf) ]]; then 
	perms="664"; 
else 
	perms="644"; 
fi
printf "\nFixing File Permissions ($perms) ... "; 
find $SITEPATH -type f -exec chmod $perms {} \;
if [[ $(grep -i ^loadmodule.*php[0-9]_module /etc/httpd/conf.d/php.conf) ]]; then 
	perms="2775"; 
else 
	perms="2755"; 
fi
printf "Fixing Directory Permissions ($perms) ... "; 
find $SITEPATH -type d -exec chmod $perms {} \;
printf "Operation Completed.\n\n";
