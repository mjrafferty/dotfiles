#! /bin/bash

readonly ARGS="$*"
readonly ARGA=("$@")

readonly AWK='/bin/awk'
readonly CAT='/bin/cat'
readonly GREP='/bin/grep'
readonly HEAD='/usr/bin/head'
readonly SED='/bin/sed'
readonly SHUF='/usr/bin/shuf'
readonly TR='/usr/bin/tr'
readonly WC='/usr/bin/wc'

_usage() {
  "$CAT" <<- EOF

  Usage: xkcd [-l <length>]

EOF
}

main () {

  if [[ "$ARGS" =~ --help$|-h$ ]]; then
    _usage;
    return 0;
  fi

  local wordList word rnd

  if [ -r /usr/local/interworx/lib/dict/words ]; then

    wordList='/usr/local/interworx/lib/dict/words';

  elif [ -r /usr/share/dict/words ]; then

    wordList='/usr/share/dict/words';

  else
    echo "No word list found.";
    return 1;
  fi

  if [[ -x /usr/bin/shuf ]]; then

    pass=$("$SHUF" -n1000 "$wordList" | "$GREP" -E '^[a-z,A-Z]{4,12}$' | "$HEAD" -n4 | "$SED" 's/^\([a-z]\)/\u\1/' | "$TR" -d '\n| ');

    echo "$pass"$(( (RANDOM % 9000) + 1000 ));

  else

    word=();

    matchList=$("$GREP" -E '^[a-z,A-Z]{4,12}$' $wordList);
    IFS=" "
    wcount=$(echo "$matchList" | "$WC" -l | "$AWK" '{print $1}')

    for ((x=0;x<4;x++)) do

      rnd=$((RANDOM % wcount))

      word[$x]=$(echo "$matchList" | "$SED" -n "${rnd}p" | "$SED" 's/^\([a-z]\)/\u\1/');

    done;

    echo "${word[0]}${word[1]}${word[2]}${word[3]}$(( RANDOM % 9000 + 1000 ))";

  fi

}

main;
