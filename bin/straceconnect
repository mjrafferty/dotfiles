#! /bin/bash

readonly ARGS="$*"
readonly ARGA=("$@")

_awkStuff() {
  awk '
  BEGIN {
    print "Line\tFile_desc\tPort\tSocket/Address";
    print "----\t---------\t----\t--------------";
  }
  {
    gsub(/:/,"",$1);
    gsub(/(connect\(|,)/,"",$2);
    if (match($4,"sin_port")) {
      gsub(/(.*\(|\),)/,"",$4);
      gsub(/(.*\("|"\).*)/,"",$5);
      print $1,$2,$4,$5
    } else {
      gsub(/(.*="|"}.*)/,"",$4);
      print $1,$2,"0",$4
    }
  }
  END {

  }'
}

main () {

  zless ${ARGA[*]} \
    | grep -no ' connect(.*'  \
    | _awkStuff \
    | column -t

}

main;
