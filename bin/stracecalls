#! /bin/bash

readonly ARGS="$*"
readonly ARGA=("$@")

_usage() {
	cat <<- EOF
	This is the usage
EOF
}

main () {

	if [[ -z "$ARGS" || "$ARGS" =~ --help$|-h$ ]]; then
		_usage;
		return 0;
	fi

	echo;
	(printf "syscall\ttime\tquantity\n%s\t%s\t%s\n" "$(dashes 10)" "$(dashes 10)" "$(dashes 10)"
	awk '{ gsub(/<|>/,"",$(NF)); syscall = gensub(/(\(..).*/,"\\1","G",$3); time[syscall]+=$(NF); numcalls[syscall]++} END { for (x in time) {print x, "\t", time[x], "\t", numcalls[x] }}' ${ARGA[*]} \
		| sed 's/\S*e-\S*/0.000001/' \
		| sort -k2nr) \
		| column -t

	echo;

}

main;
