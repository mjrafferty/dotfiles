#! /bin/bash

# Check parameters
if [[ ! $1 ]]; then
	printf "No domain given. This command requires a domain as an argument.\n";
	exit 1;
elif [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]] || [[ "$1" == "help" ]]; then
	printf "Usage: findsite [DOMAIN]\n\n";
	printf "[DOMAIN] must be the target domain you wish to locate.\n";
	exit 1;
fi

# Trim any fat off the domain name
domain=$(echo "$1" | sed -r -e 's_https?://__' -e 's_/$__' | tr "[:upper:]" "[:lower:]");

# Get ip and registration info
ip_addr="$(dig +short "$domain" | head -n1)";
whoisinfo="$(whois "$ip_addr")";

# If site pointed at nexcess
nexcess=$(echo "$whoisinfo"  | grep -m1 -io nexcess);

if [ "$nexcess" ]; then
	ssh;
else

	# If site not pointed at nexcess
	findsitelist=$(findsite "$domain");

	declare -a find_servers find_ips;

	find_servers=($(echo "${findsitelist}" | awk '{print $1}'));
	find_ips=($(echo "${findsitelist}" | awk '{print $2}'));

fi
