#! /bin/awk -f

BEGIN {

  YEAR=strftime("%Y");
  REGEX=YEAR":..:.."

  inc=0;
  max=0;

}

{

  start = match($0,REGEX) + 5

  if (interval == 1) {
    stop = 5
    timestamp = substr($0,start,stop)
  }
  else if(interval == 2) {
    stop = 5
    temp = substr($0,start,stop)
  }
  else if(interval == 5) {
    stop = 5
    temp = split(substr($0,start,stop),test,":");
    timestamp = temp[1]":"((temp[2] / 5) * 5)
  }
  else if(interval == 10) {
    stop = 4
    timestamp = substr($0,start,stop)"0"
  }
  else {
    stop = 3
    timestamp = substr($0,start,stop)"00"
  }

  hits[timestamp]++

}

END {

  GRAY="\033[1;30m"
  RED="\033[1;31m"
  GREEN="\033[1;32m"
  YELLOW="\033[1;33m"
  BLUE="\033[1;34m"
  PURPLE="\033[1;35m"
  CYAN="\033[1;36m"
  WHITE="\033[1;37m"
  RESET="\033[0m "

  for(x in hits){
    if(hits[x]>max){
      max=hits[x]
    }
  }

  n=asorti(hits,hits2)

  printf "\n";
  for (x=1;x<=n;x++){
    printf "%s\t%s\t",WHITE hits2[x],BLUE hits[hits2[x]];
    for (i=0; i<(hits[hits2[x]] * 100 / max);i++)
    {
      printf "%s",GREEN"*";
    }
    printf "\n"
  }
  printf "\n"
}
