#! /bin/bash

## Find configuration file, and echo configured DB name

if [[ -z "$1" ]]; then
  SITEPATH=".";
else
  SITEPATH="$1";
fi;

# If site is Mage
if [[ -f $SITEPATH/app/etc/local.xml ]]; then

  grep dbname "$SITEPATH"/app/etc/local.xml \
    | cut -d\[ -f3 \
    | cut -d\] -f1

  # If site is WP
elif [[ -f "$SITEPATH"/wp-config.php ]]; then

  grep DB_NAME "$SITEPATH"/wp-config.php \
    | cut -d\' -f4

  # If site is Joomla
elif [[ -f $SITEPATH/configuration.php ]]; then

  grep '$db ' "$SITEPATH"/configuration.php \
    | cut -d\' -f2

  # If site is SurgarCRM
elif [[ -f "$SITEPATH"/sugar_version.php ]]; then

  grep db_name "$SITEPATH"/config.php \
    | cut -d\' -f4

  # If site is vBulletin 4.x
elif [[ -f $SITEPATH/includes/config.php ]]; then

  grep dbname "$SITEPATH"/includes/config.php \
    | cut -d\' -f6

  # If site is vBulletin 5.x
elif [[ -f $SITEPATH/upload/core/includes/config.php ]]; then

  grep dbname "$SITEPATH"/upload/core/includes/config.php \
    | cut -d\' -f6

  # If site is EE or another CodeIgniter app
elif [[ "$1" == "EE" || "$1" == "ee" ]]; then

  if [[ -z "$2" ]]; then
    SITEPATH="/home/$(getusr)";
  else
    SITEPATH="$2";
  fi

  CONFIG=$(find "$SITEPATH" -type f -name database.php -print)

  grep \'database\' "$CONFIG" \
    | cut -d\' -f6

else # If there is no config to be found ...

  echo "${RED}Could not find configuration file!${NORMAL}";

fi
