#! /bin/bash

_m () {
  mysql -u"$(grep '^rootdsn=' /usr/local/interworx/iworx.ini | cut -d/ -f3 | cut -d: -f1)" \
    -p"$(grep '^rootdsn=' /usr/local/interworx/iworx.ini | cut -d: -f3 | cut -d\@ -f1)" "$1"
}

count=$(_m -e'select count(*) from information_schema.PROCESSLIST where TIME>=10\G' 2> /dev/null \
  | sed -n 's/count(\*): \([0-9]*\).*/\1/p');

if [ -n "$count" ] && [ "$count" -ge 10 ]; then
  echo "$count long running queries";
fi

