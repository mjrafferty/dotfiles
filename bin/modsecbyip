#! /bin/bash

IP="$1";

if [ -z "$IP" ]; then
  echo "No IP address provided";
else

  uniqueid=$(sed -n 's/.*'"$IP"'.*\[uri \"\([^"]\).*unique_id \"\([^"]*\).*/\2\t\1/p' error.log);

  for ((i=0;i<${#uniqueid[@]};i++)); do
    modsecrules "${uniqueid[$i]}";
  done \
    | sort -u \
    | sed 's/^/SecRuleRemoveById /';

  grep "$1" error.log \
    | grep ModSecurity \
    | sed 's/.*uri \"//' \
    | sed 's/\"].*//' \
    | sort -u;
fi
