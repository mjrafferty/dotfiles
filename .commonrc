#! /bin/zsh

# Automatically open and close tmux session when connecting via SSH
if type tmux &> /dev/null && [[  -z $TMUX && -n $SSH_TTY ]]; then
  (tmux has-session -t "${HOME/*\//}" &> /dev/null && tmux attach -t "${HOME/*\//}") \
    || tmux new-session -s "${HOME/*\//}"
  exit;
fi

[ -r "${HOME}/.zsh/env.sh" ] \
  && source "${HOME}/.zsh/env.sh"

##### Completions Options #####
zstyle ':completion:*' completer _expand _complete _ignored _match _correct _approximate _prefix
zstyle ':completion:*' group-name ''
zstyle ':completion:*' insert-unambiguous true
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' list-prompt %SAt %p: Hit TAB for more, or the character to insert%s
zstyle ':completion:*' matcher-list '' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]}' 'r:|[._-]=** r:|=**' 'l:|=* r:|=*'
zstyle ':completion:*' max-errors 2 numeric
zstyle ':completion:*' menu select=1
zstyle ':completion:*' original true
zstyle ':completion:*' prompt '%e errors. Did you mean:'
zstyle ':completion:*' select-prompt %SScrolling active: current selection at %p%s
zstyle ':completion:*' verbose true

setopt complete_aliases
setopt complete_in_word
setopt auto_param_slash
setopt auto_name_dirs
setopt auto_list
setopt rec_exact
setopt list_types

setopt autocd
setopt auto_pushd
setopt cdable_vars
setopt chase_dots
setopt chase_links

setopt multibyte
setopt extendedglob
setopt nomatch
setopt notify

setopt appendhistory
setopt hist_ignore_dups
setopt hist_fcntl_lock
setopt hist_verify
setopt menu_complete
unsetopt beep

bindkey -v

[ -r "${HOME}/.zsh/zsh-histdb/sqlite-history.zsh" ] \
  && source "$HOME/.zsh/zsh-histdb/sqlite-history.zsh"

[ -r "${HOME}/.zsh/apollo-zsh-theme/prompt_apollo_setup" ] \
  && source "$HOME/.zsh/apollo-zsh-theme/prompt_apollo_setup"

[ -r "${HOME}/.zsh/zsh-completions/zsh-completions.plugin.zsh" ] \
  && source "$HOME/.zsh/zsh-completions/zsh-completions.plugin.zsh"

[ -r "${HOME}/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh" ] \
  && source "$HOME/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh"

[ -r "${HOME}/.zsh/zsh-history-substring-search/zsh-history-substring-search.zsh" ] \
  && source "$HOME/.zsh/zsh-history-substring-search/zsh-history-substring-search.zsh"

autoload -Uz compinit
compinit

[ -r "${HOME}/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ] \
  && source "$HOME/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"

ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets line)
ZSH_HIGHLIGHT_STYLES[line]='bold'

[ -r "${HOME}/.zsh/alias.sh" ] \
  && source "${HOME}/.zsh/alias.sh"

[ -r "${HOME}/.zsh/functions.sh" ] \
  && source "${HOME}/.zsh/functions.sh"

fpath=($HOME/.zsh/completions $fpath)

setopt nullglob

## Vi key bindings
bindkey -v
