#compdef nkmagento

local curcontext=$curcontext state line
declare -A opt_args

_nkmagento() {
  local curcontext="$curcontext" state line
  typeset -A opt_args

  _arguments \
    '1: :->command'\
    '*: :->args'
  if [[ "$state" == "args" ]]; then
    case "$line" in
      "info ")
        #COMPREPLY=( $(compgen -W "" -- ${cur}) )
        ;;

      "install ")
        compadd -E --enterprise -l --admin-location --admin-pass --admin-user --admin-email -a --auto-create-database -D --only-database -p --package -b --base-url -s --secure-base-url -d --install-sample-data --database-host -N --database-name -P --database-pass -U --database-user --database-port -m --use-memcache -y --assume-yes;
        ;;

      "repair ")
        #COMPREPLY=( $(compgen -W "-p --set-permissions -o --set-ownership -c --clear-cache --clear-sessions -C --set-cache-method -S --set-session-storage -e --install-extension -b --set-base-url -B --set-secure-base-url -r --reset-admin-pass -i --reindex --cdn-base-url --secure-cdn-base-url -L --toggle-logging -l --log-rotation --toggle-log-rotation -R --set-return-path --reset-db-pass" -- ${cur}) )
        ;;

      "copy ")
        #COMPREPLY=( $(compgen -W "-x --exclude-dirs -a --auto-create-database -N --new-database-name -U --new-database-user -P --new-database-pass -b --new-base-url -y --assume-yes" -- ${cur}) )
        ;;

      "link ")
        #COMPREPLY=( $(compgen -W "" -- ${cur}) )
        ;;

      "dbrepair ")
        #COMPREPLY=( $(compgen -W "--setup-only -b --backup -r --restore-on-error -y --assume-yes -c --change-log" -- ${cur}) )
        ;;

      "backup ")
        #COMPREPLY=( $(compgen -W "-o --output -d --database-only -f --files-only -F --force" -- ${cur}) )
        ;;

      "crondump ")
        #COMPREPLY=( $(compgen -W "-s --start-time -e --end-time -f --format -d --delimiter -H --hide-header -R --repeat-header" -- ${cur}) )
        ;;


      "*")
        ;;
    esac
  elif echo "$prev" | grep -qE '^-'; then
    # list possible option->choices
    case "$prev" in
      -C|--set-cache-method)
        COMPREPLY=( $(compgen -W "file  files  apc  memcached  memcache  redis" -- ${cur}) )
        ;;

      -S|--set-session-storage)
        COMPREPLY=( $(compgen -W "files  file  db  memcache  memcached  redis" -- ${cur}) )
        ;;

      -f|--format)
        COMPREPLY=( $(compgen -W "csv  table" -- ${cur}) )
        ;;


      *)
        ;;
    esac
  else
    compadd info install repair copy link dbrepair backup crondump;
  fi
}
compdef _nkmagento nkmagento
